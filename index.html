<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="initial-scale=1.0, maximum-scale=1, user-scalable=no, width=device-width">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <title>MediaLAB-Schiphol</title>
        
        <link type="text/css" rel="stylesheet" href="css/index.css">
		
        
        
       		<script type="text/javascript" src="lib/grid.js"></script>
			<script type="text/javascript" src="lib/version.js"></script>
			<script type="text/javascript" src="lib/detector.js"></script>
			<script type="text/javascript" src="lib/formatinf.js"></script>
			<script type="text/javascript" src="lib/errorlevel.js"></script>
			<script type="text/javascript" src="lib/bitmat.js"></script>
			<script type="text/javascript" src="lib/datablock.js"></script>
			<script type="text/javascript" src="lib/bmparser.js"></script>
			<script type="text/javascript" src="lib/datamask.js"></script>
			<script type="text/javascript" src="lib/rsdecoder.js"></script>
			<script type="text/javascript" src="lib/gf256poly.js"></script>
			<script type="text/javascript" src="lib/gf256.js"></script>
			<script type="text/javascript" src="lib/decoder.js"></script>
			<script type="text/javascript" src="lib/qrcode.js"></script>
			<script type="text/javascript" src="lib/findpat.js"></script>
			<script type="text/javascript" src="lib/alignpat.js"></script>
			<script type="text/javascript" src="lib/databr.js"></script>
            <script type="text/javascript" src="lib/BigInteger.min.js"></script>
			<script type="text/javascript" src="lib/zxing-pdf417.js"></script>
            
            <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
         <script>
	     var lastname, firstname, origin, flightnumber, airline, beltnumber; 
        (function(window, $, undefined) {
            $(function() {

                function handleFiles(f) {
                    var img = $('#scanned-img');
                    img[0].src = URL.createObjectURL(f.target.files[0]);
                }

                function doScan(image) {
                    var
                            canvas = document.createElement('canvas'),
                            canvas_context = canvas.getContext('2d'),
                            source,
                            binarizer,
                            bitmap;

                    canvas.width = image.naturalWidth;
                    canvas.height = image.naturalHeight;
                 canvas_context.drawImage(image, 0, 0, canvas.width, canvas.height);
					$('#scanned-img').hide();
				
                    try {
                        source = new ZXing.BitmapLuminanceSource(canvas_context, image);
                        binarizer = new ZXing.Common.HybridBinarizer(source);
                        bitmap = new ZXing.BinaryBitmap(binarizer);
						var data = JSON.stringify(ZXing.PDF417.PDF417Reader.decode(bitmap, null, false), null, 4);
                        
						if (data.length >2){
					    var dataJSON = JSON.parse(data); 
						
						
						var info = dataJSON[0].Text; 
						
						info = info.replace(/\s+/g, ' ');

						info = info.split(" "); 
						 
						for (i=0;i<info.length; i++){
							if (info[i] != " "){
							console.log(info[i]); 
							}
							}
					   
					    fullname = info[0].substring(2, info[0].length);
						
				        fullname = fullname.split("/");
						
						lastname = fullname[0]; initial = fullname[1]; 
						
				        airline = info[1].substring(info[1].length-=2, info[1].length); 
                            
                            
                       origin = info[1].substring(info[1].length-=8, info[1].length-5);
                            
                            
                        flightnumber = airline += info[2].substring(info[2].length-=3, info[2].length);    
                          
						console.log("Name: " + initial + ". " + lastname);

                        
                        
                        } else { 
						
						beltnumber = prompt("Sorry, unable to read your boarding pass at this time. Please fill in your belt number");
						
						 }
						
						
                    } catch (err) {
                        console.log(err);
                    }
                }
				
                $('#scan-btn').click(function() {
                    doScan($('#scanned-img')[0]);
                });

                $('#scanned-img').load(function() {
                    doScan($('#scanned-img')[0]);
                });

                $('#scan-btn').change(handleFiles);
            });
        })(window, window.jQuery);
    </script>
            <script type="text/javascript"> 
			
							var gCtx = null;
							var gCanvas = null;

							var imageData = null;
							var ii=0;
							var jj=0;
							var c=0, files;
							
								$("#scan-btn").on('change',function (e){
									if(e){
									files = e.dataTransfer.files;
									console.log(files.length); }
								});
	
								function dragenter(e) {
  											e.stopPropagation();
  											e.preventDefault();
										}

								function dragover(e) {
 											e.stopPropagation();
  											e.preventDefault();
										}
								function drop(e) {
 											e.stopPropagation();
 											e.preventDefault();

  											var dt = e.dataTransfer;
 											var files = dt.files;
										 if  (files.length >0){
  											fileHandler(files[0]);  
									 }
							
						 
			
					function fileHandler(){
						    console.log("filehandler active"); 
							
							var o=[];
							var gCanvas = document.getElementById("qr_canvas"); 
							var decodeResult = null;
							qrcode.callback = read;
							console.log("file count: "+ f.length);
							
							for(var i =0;i<f.length;i++)
							{
									var reader = new FileReader();
									reader.onload = (function(theFile) {
									return function(e) {
													qrcode.decode(e.target.result);
							
									};
									})(f[i]);
									reader.readAsDataURL(f[i]);
							 
								}


}  
function read(a)
{
console.log ("reading"); 

var html="<br>";
    if(a.indexOf("http://") === 0 || a.indexOf("https://") === 0)
        html+="<a target='_blank' href='"+a+"'>"+a+"</a><br>";
    html+="<b>"+a+"</b><br><br>";
    console.log(html);
    document.getElementById("result").innerHTML=html;
}
								
							function load()
							{
								initCanvas(200,200);
								qrcode.callback = read;
								qrcode.decode("src/test/WikiTest.jpg");
							}
							
							function initCanvas(ww,hh)
								{
									gCanvas = document.getElementById("qr_canvas");
									gCanvas.on("dragenter", dragenter, false);  
									gCanvas.on("dragover", dragover, false);  
									gCanvas.on("drop", drop, false);
									var w = ww;
									var h = hh;
									gCanvas.style.width = w + "px";
									gCanvas.style.height = h + "px";
									gCanvas.width = w;
									gCanvas.height = h;
									gCtx = gCanvas.getContext("2d");
									gCtx.clearRect(0, 0, w, h);
									imageData = gCtx.getImageData( 0,0,320,240);
								}
							
								function passLine(stringPixels) { 
									//a = (intVal >> 24) & 0xff;
							
									var coll = stringPixels.split("-");
								
									for(var i=0;i<320;i++) { 
										var intVal = parseInt(coll[i]);
										r = (intVal >> 16) & 0xff;
										g = (intVal >> 8) & 0xff;
										b = (intVal ) & 0xff;
										imageData.data[c+0]=r;
										imageData.data[c+1]=g;
										imageData.data[c+2]=b;
										imageData.data[c+3]=255;
										c+=4;
									} 
							
									if(c>=320*240*4) { 
										c=0;
											gCtx.putImageData(imageData, 0,0);
									} 
								} 
							
									function captureToCanvas(file) {
									//canvas = document.getElementById("qr_canvas");
									qrcode.callback = function(data) { alert(data); };
									var result= qrcode.decode(readfile);
									console.log(result); 
									}
								}
     

</script>

  
    </head>
    
 
    
    <div id="tp_One" height=100%> 
       <div id="container" class="container">
       
       
       
            <div id="type-form-container"> </div>
           
            <div id="scan-form" onLoad="load()"> 
            		<canvas id="qr_canvas"> </canvas>
       				<form id="tpOne_form">
       				  <br>
                      <input type="file"  id="scan-btn" accept="image/*" capture />
                		<div id="result"> </div><br>
               			
                        <span><button id="next-div" type="button" >Submit</button></span> 
                        <img id="scanned-img" src=""/>
        			</form><br>
                    
            </div>
            <div class="decodedText"></div>
       </div>
      
    </div>
     <!-- 4 option menu --> 
    <div id="main-menu" class="main-menu">
    		          <a href="#item1" class="main-menu-btn" ><div><h3>Game</h3></div></a>
    
   					    <a href=#chatbot id="main-menu-btn-chat"class="main-menu-btn"><div width=100%><h3>Chat</h3></div></a>    
    					
                        <a href="#item3" class="main-menu-btn"><div width=100%><h3>Map</h3></div></a>
    
                        <a href=#family class="main-menu-btn"><div width=100%><h3>Family</h3></div></a>
   
    	<!--
<div id="menu-btns" class="menu-btns">
   					 <table id="menu-ls" class="new-menu" > 
   
    					<tr>
   							<td><a href="#item1" class="main-menu-btn" ><div><img src="src/game_icon.png" width="100" height="100"> <p>Game</p></div></a></td>
    
   							<td><a href=#chatbot id="main-menu-btn-chat"class="main-menu-btn">
                            <div>
                           		 <img src="src/chat_icon.png" width="100" height="100"> <p>Chat</p>
                                 </div>
                                 </a></td>
    
    					</tr>
                        <tr>
    <td><a href="#item3" class="main-menu-btn"><div><img src="src/map_icon.png" width="100" height="100"> <p>Map</p></div></a></td>
    
    <td><a href="#item4" class="main-menu-btn"><div><img src="src/family_icon.png" width="100" height="100"><p>Family</p></div></a></td>
    </tr>
    </table>
    </div>-->
    </div>
    
    <!-- Chatbot-->
    <div id="chatbot" height="100%" > 
                
      			<div id="content" class="content"   >
                <div id="nav-bar" class="nav-bar"  >  
                	<a id="menu-btn"class="menu-btn" href=#main-menu ><img src="src/menu.png" width="20px" height="20px"/> </a> 
                	
                   	<a class="bot-icon-link" ><img id="bot-icon" class="bot-icon" width="45px" height="45px" /></a>
                 	
                </div>
         			<div id="chat" class="chat"> </div>
    			</div> 
                <div class="form" ><form  > 
       			<span><textarea id="message-input" type="text" placeholder="Type a message.."></textarea>
               
                <img id="post-btn" src="src/post_btn.png" width="30vh" height="30vh">
                
                </span>
       			</form></div>
    </div>
           
            </div>
       
    </div>
            </div>
<!-- bot Family -->
<div id="family"> 

</div>

             
    		<script type="application/javascript" src="js/index.js"></script>
            <script type="text/javascript" src="js/sendRequest.js"> </script>  
         
             
            
               
        </body>
        
    
</html>